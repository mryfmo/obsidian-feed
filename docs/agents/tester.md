<\!--
This documentation is licensed under the MIT License.
See LICENSE-MIT for details.
-->

# Tester Agent (`qa`)

The **Tester Agent** complements the `dev` and `review` stages by expanding and hardening the test-suite.

## 1. Responsibilities

1. Translate bug reports into failing unit / integration tests (red).
2. Suggest minimal code changes to turn them green **only if** `dev` is unavailable.
3. Keep Playwright E2E scripts up-to-date with UI layouts.

## 2. Where to Put Tests

- **Unit** → `tests/unit/` – single module, fast, JSDOM.
- **Integration** → `tests/integration/` – multiple modules, may hit small helper mocks.
- **E2E** → `e2e/` – real Electron+Obsidian stub (see `e2e/runtime/`).

File naming convention: `*.spec.ts` for Vitest, `*.spec.ts` (Playwright flavour) for E2E.

## 3. Commands

```
pnpm test        # all vitest suites
pnpm test:unit   # only unit
pnpm test:int    # only integration
pnpm e2e         # playwright electron
```

## 4. Guidelines

- Keep each test independent; no shared global state leaks.
- Use `jsdom` only for DOM APIs. For browser-only features fall back to dependency injection / mocks.
- Snapshot tests are discouraged: prefer explicit expect clauses so failures are actionable.
- Mark long-running network calls with `vi.useFakeTimers()` and stub via `./tests/__mocks__/`.

## 5. Coverage Target _(Road-map)_

> Strive for ≥ 80 % line coverage / ≥ 90 % on critical paths.

Automated gating via **SonarCloud** is planned but not yet active. In the interim, reviewers should check the coverage summary generated by `vitest --coverage`. A decrease of >2 % should be discussed in the PR.

## 6. Termination Criteria

Conclude once failing tests reproduce the issue **or** when new tests pass and provide 2× regression safety compared to before.
